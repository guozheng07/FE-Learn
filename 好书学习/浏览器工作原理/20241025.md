# 课程导读
- 简单描述渲染流水线视角下的 CSS渲染流程？
- CSSOM是什么？渲染流水线为什么需要 CSSOM ？
- 缩短白屏时长有哪些策略？
- 显示器是怎么显示图像的？显卡做什么呢？
- 什么是帧、什么是帧率？
- 分层和合成机制为什么能解决每帧生成时间过久的问题？
- 生成一帧图像有哪些方式？这些方式之间有什么区别？
- 什么是分层、什么是合成？
- 为什么要引入合成和分层？
- Chrome 浏览器是怎么实现分层和合成的操作？
- 分块是如何提升渲染效率的？
- 如何利用分层技术优化代码？

# 23｜渲染流水线：CSS如何影响首次加载时的白屏时间？
在上一篇文章中我们详细介绍了 DOM 的生成过程，并结合具体例子分析了 JavaScript 是如何阻塞 DOM 生成的。那本文我们就继续深入聊聊渲染流水线中的 CSS。因为 CSS 是页面中非常重要的资源，它决定了页面最终显示出来的效果，并影响着用户对整个网站的第一体验。所以，搞清楚浏览器中的 CSS 是怎么工作的很有必要，只有理解了 CSS 是如何工作的，你才能更加深刻地理解如何去优化页面。

本文我们先站在渲染流水线的视角来介绍 CSS 是如何工作的，然后通过 CSS 的工作流程来分析性能瓶颈，最后再来讨论如何减少首次加载时的白屏时间。

渲染流水线视角下的 CSS 我们先结合下面代码来看看最简单的渲染流程：
```
// theme.css
div{ 
    color : coral;
    background-color:black
}
```

```
<html>
  <head>
      <link href="theme.css" rel="stylesheet">
  </head>
  <body>
      <div>geekbang com</div>
  </body>
</html>
```

这两段代码分别由 CSS 文件和 HTML 文件构成，我们来分析下打开这段 HTML 文件时的渲染流水线，你可以先参考下面这张渲染流水线示意图：

![image](https://github.com/user-attachments/assets/5c65afd1-86c6-4da4-81bc-b693fd927388)

下面我们结合上图来分析这个页面文件的渲染流水线。

首先是发起主页面的请求，这个发起请求方可能是渲染进程，也有可能是浏览器进程[^1]，发起的请求被送到网络进程中去执行。网络进程接收到返回的 HTML 数据之后，将其发送给渲染进程，渲染进程会解析 HTML 数据并构建 DOM。这里你需要特别注意下，请求 HTML 数据和构建 DOM 中间有一段空闲时间，这个空闲时间有可能成为页面渲染的瓶颈。

上一篇文章中我们提到过，当渲染进程接收 HTML 文件字节流时，会先开启一个**预解析线程**，如果遇到 JavaScript 文件或者 CSS 文件，那么预解析线程会提前下载这些数据。对于上面的代码，预解析线程会解析出来一个外部的 theme.css 文件，并发起 theme.css 的下载。这里也有一个空闲时间需要你注意一下，就是在 DOM 构建结束之后、theme.css 文件还未下载完成的这段时间内，渲染流水线无事可做，因为下一步是合成布局树，而合成布局树需要 CSSOM 和 DOM，所以这里需要等待 CSS 加载结束并解析成 CSSOM。

## 那渲染流水线为什么需要 CSSOM 呢？


# 24｜分层和合成机制：为什么css动画比JavaScript高效

[^1]: 发起主页面的请求
1. 浏览器进程发起请求:
   - 当用户在地址栏输入URL时,浏览器进程负责处理输入并发起初始网络请求
   - 浏览器进程管理网络资源和安全策略,适合处理主页面的初始请求
2. 渲染进程发起请求:
   - 页面加载后,渲染进程负责执行JavaScript等,可能会发起AJAX等后续请求
   - 对于单页应用(SPA),页面切换时的请求通常由渲染进程中的JavaScript发起
3. 具体情况:
   - 首次加载主页面:通常由浏览器进程发起
   - 页面内导航或动态加载:通常由渲染进程发起
4. 影响因素:
   - 浏览器实现方式
   - 网页的具体架构(传统多页面还是SPA)
   - 请求发起的具体位置和时机
